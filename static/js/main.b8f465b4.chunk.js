(this.webpackJsonpeventbot=this.webpackJsonpeventbot||[]).push([[0],{124:function(e,t,n){"use strict";n.r(t);var c=n(1),s=n.n(c),a=n(49),r=n.n(a),i=(n(57),n(4)),o=n.n(i),u=n(9),l=n(12),j=(n(59),n(2)),h=(n(60),n(11)),d=Object(c.createContext)(null),b=n(0);var f=function(e){var t=e.onLogout,n=Object(c.useContext)(d).workspace;return Object(b.jsxs)("div",{className:"nav-bar",children:[Object(b.jsx)("h1",{children:"EventBot"}),n&&Object(b.jsxs)("div",{children:[Object(b.jsxs)("div",{className:"workspace",children:[Object(b.jsx)("h3",{children:n.team.name}),Object(b.jsx)("button",{onClick:t,children:"Log Out"})]}),Object(b.jsxs)("ul",{children:[Object(b.jsx)("li",{children:Object(b.jsx)(h.b,{to:"/",children:"Home"})}),Object(b.jsx)("li",{children:Object(b.jsx)(h.b,{to:"/sendMessage",children:"Send Message"})}),Object(b.jsx)("li",{children:Object(b.jsx)(h.b,{to:"/scheduleMessage",children:"Schedule Message"})})]})]})]})};n(66);var O=function(e){var t=e.onSubmit;return Object(b.jsxs)("div",{children:[Object(b.jsx)("h1",{children:"Enter Slack Token"}),Object(b.jsxs)("form",{onSubmit:t,children:[Object(b.jsx)("input",{type:"password"}),Object(b.jsx)("input",{type:"submit"})]})]})},p=n(27),v=n(51),x=n(52),m=function(){function e(t){Object(v.a)(this,e),this.slackClient=t}return Object(x.a)(e,[{key:"postMessage",value:function(e,t){this.slackClient.chat.postMessage({text:e,channel:t}).catch((function(n){console.error(n,{channel:t,message:e}),alert("Unable to post message. Review the error message in the console.")}))}},{key:"scheduleMessage",value:function(e,t,n){this.slackClient.chat.scheduleMessage({channel:t,text:e,post_at:n}).catch((function(c){console.error(c,{channel:t,text:e,post_at:n}),alert("Unable to schedule message. Review the error message in the console.")}))}},{key:"getScheduledMessages",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.chat.scheduledMessages.list();case 2:return t=e.sent,e.abrupt("return",t.scheduled_messages);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteScheduledMessage",value:function(e,t){this.slackClient.chat.deleteScheduledMessage({scheduled_message_id:e,channel:t}).catch((function(n){console.error(n,{scheduled_message_id:e,channel:t}),alert("Unable to delete scheduled message. Review the error message in the console.")}))}},{key:"validateToken",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t=this;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.auth.test().catch((function(e){return Promise.reject("Invalid token: '".concat(t.slackClient.token,"'"))}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWorkspace",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t,n,c,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.slackClient.conversations.list().then((function(e){return{channels:e.channels.map((function(e){return{id:e.id,name:e.name}})).sort((function(e,t){return e.name>t.name?1:-1}))}})),this.slackClient.team.info().then((function(e){return{team:{name:e.team.name,icon:e.team.icon.image_230}}}))]);case 2:return t=e.sent,n=Object(l.a)(t,2),c=n[0],s=n[1],e.abrupt("return",Object(p.a)(Object(p.a)({},c),s));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();n(67);var g=function(e){var t=e.submitAction,n=Object(c.useContext)(d).workspace,s=(n=void 0===n?{}:n).channels,a=Object(c.useRef)(null),r=Object(c.useRef)(null);return Object(b.jsx)("div",{className:"message-sender",children:Object(b.jsxs)("form",{onSubmit:function(e){e.preventDefault();var n=a.current.value,c=r.current.value;n&&(t(n,c),a.current.value="")},children:[Object(b.jsx)("textarea",{type:"text",ref:a}),Object(b.jsxs)("div",{children:[Object(b.jsx)("select",{defaultValue:s?s[0].id:"",ref:r,children:s&&s.map((function(e,t){return Object(b.jsx)("option",{value:e.id,children:e.name},t)}))}),Object(b.jsx)("input",{type:"submit"})]})]})})};var k=function(){var e=Object(c.useContext)(d).slackClient;return Object(b.jsxs)("div",{children:[Object(b.jsx)("h1",{children:"Send message"}),Object(b.jsx)(g,{submitAction:function(t,n){e.postMessage(t,n)}})]})};var S=function(){return Object(b.jsxs)("div",{children:[Object(b.jsx)("h1",{children:"Welcome to EventBot"}),Object(b.jsx)("p",{children:"Select an action on the left nav bar"})]})};var w=function(){var e=Object(c.useContext)(d).slackClient,t=Object(c.useState)([]),n=Object(l.a)(t,2),s=n[0],a=n[1],r=Object(c.useRef)(null);Object(c.useEffect)((function(){i()}),[]);var i=function(){e.getScheduledMessages().then((function(e){a(e)}))},j=function(){var t=Object(u.a)(o.a.mark((function t(n,c){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.deleteScheduledMessage(n,c),i();case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return Object(b.jsxs)("div",{children:[Object(b.jsx)("h1",{children:"Schedule message"}),Object(b.jsx)("input",{ref:r,placeholder:"Epoch time"}),Object(b.jsx)(g,{submitAction:function(t,n){e.scheduleMessage(t,n,r.current.value)}}),Object(b.jsx)("h3",{children:"Scheduled Messages"}),s.map((function(e){var t=e.id,n=e.channel_id,c=e.post_at,s=e.text;return Object(b.jsxs)("div",{children:[Object(b.jsxs)("div",{children:[Object(b.jsx)("i",{children:c})," in ",n]}),Object(b.jsx)("p",{children:s}),Object(b.jsx)("button",{onClick:function(){j(t,n)},children:"Delete"})]},t)}))]})},C=n(68).WebClient;var M=function(){var e=Object(c.useState)(localStorage.slackToken),t=Object(l.a)(e,2),n=t[0],s=t[1],a=Object(c.useState)(),r=Object(l.a)(a,2),i=r[0],h=r[1],p=Object(j.e)(),v=Object(j.f)(),x=new m(new C(n));Object(c.useEffect)((function(){n?(localStorage.setItem("slackToken",n),g()):(localStorage.removeItem("slackToken"),p.push("/login"))}),[n]);var g=function(){var e=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,x.validateToken();case 3:return e.t0=h,e.next=6,x.loadWorkspace();case 6:e.t1=e.sent,(0,e.t0)(e.t1),"/login"===v.pathname&&p.push("/"),e.next=15;break;case 11:e.prev=11,e.t2=e.catch(0),s(),alert(e.t2);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),M=function(e){e.preventDefault(),s(e.target[0].value),e.target[0].value=""};return Object(b.jsx)("div",{className:"App",children:Object(b.jsxs)(d.Provider,{value:{slackClient:x,workspace:i},children:[Object(b.jsx)(f,{onLogout:function(){s(),h()}}),Object(b.jsxs)("div",{className:"content",children:[Object(b.jsx)(j.a,{exact:!0,path:"/",component:S}),Object(b.jsx)(j.a,{path:"/sendMessage",component:k}),Object(b.jsx)(j.a,{path:"/scheduleMessage",component:w}),Object(b.jsx)(j.a,{path:"/login",render:function(){return Object(b.jsx)(O,{onSubmit:M})}})]})]})})};r.a.render(Object(b.jsx)(s.a.StrictMode,{children:Object(b.jsx)(h.a,{children:Object(b.jsx)(M,{})})}),document.getElementById("root"))},57:function(e,t,n){},59:function(e,t,n){},60:function(e,t,n){},66:function(e,t,n){},67:function(e,t,n){}},[[124,1,2]]]);
//# sourceMappingURL=main.b8f465b4.chunk.js.map