(this.webpackJsonpeventbot=this.webpackJsonpeventbot||[]).push([[0],{140:function(e,t,n){},142:function(e,t,n){"use strict";n.r(t);var r=n(0),s=n.n(r),c=n(28),a=n.n(c),i=(n(75),n(19)),u=n(70),o=n(4),l=n.n(o),h=n(8),d=n(5),j=(n(77),n(9)),b=Object(r.createContext)(null),f=(n(78),n(22)),p=n(2);var O=function(e){var t=e.onLogout,n=Object(r.useContext)(b).workspace;return Object(p.jsxs)("div",{className:"nav-bar",children:[Object(p.jsx)("h1",{children:"EventBot"}),n&&Object(p.jsxs)("div",{children:[Object(p.jsxs)("div",{className:"workspace",children:[Object(p.jsx)("h3",{children:n.team.name}),Object(p.jsx)("button",{onClick:t,children:"Log Out"})]}),Object(p.jsxs)("ul",{children:[Object(p.jsx)("li",{children:Object(p.jsx)(f.b,{to:"/",children:"Home"})}),Object(p.jsx)("li",{children:Object(p.jsx)(f.b,{to:"/sendMessage",children:"Send Message"})}),Object(p.jsx)("li",{children:Object(p.jsx)(f.b,{to:"/scheduleMessage",children:"Schedule Message"})}),Object(p.jsx)("li",{children:Object(p.jsx)(f.b,{to:"/editMessage",children:"Edit Message"})})]})]})]})};n(84);var x=function(e){var t=e.login,n=Object(r.useState)(""),s=Object(d.a)(n,2),c=s[0],a=s[1],i=Object(r.useState)(!1),u=Object(d.a)(i,2),o=u[0],j=u[1],b=Object(r.useState)(null),f=Object(d.a)(b,2),O=f[0],x=f[1],v=function(){var e=Object(h.a)(l.a.mark((function e(n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),j(!0),e.next=4,t(c);case 4:e.sent||(x(!1),j(!1),alert("Invalid token: ".concat(c)));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=Object(p.jsx)("div",{className:"invalid-feedback",children:"invalid token"});return Object(p.jsxs)("div",{children:[Object(p.jsx)("h1",{children:"Enter Slack Token"}),Object(p.jsxs)("form",{onSubmit:v,children:[Object(p.jsx)("label",{htmlFor:"token-input",children:"Slack Token"}),Object(p.jsx)("input",{type:"password",id:"token-input",value:c,onChange:function(e){return a(e.target.value)},required:!0}),Object(p.jsx)("button",{type:"submit",disabled:o,children:"Login"}),!1===O&&g]})]})},v=n(17),g=n(18),m=n(68),k=new(function(){function e(){Object(v.a)(this,e)}return Object(g.a)(e,[{key:"init",value:function(){var e=Object(h.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.slackClient=new m.WebClient(t),delete this.slackClient.axios.defaults.headers["User-Agent"],e.next=4,this.validateToken();case 4:return n=e.sent,this.userId=n.user_id,e.next=8,this._getLogChannel();case 8:this.logChannel=e.sent;case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){delete this.slackClient}},{key:"postMessage",value:function(){var e=Object(h.a)(l.a.mark((function e(t,n){var r,s,c=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(c.length>2&&void 0!==c[2])||c[2],e.next=3,this.slackClient.chat.postMessage({text:t,channel:n}).catch((function(e){console.error(e,{channel:n,message:t}),alert(e+"\n\nSee the full error message in the console.")}));case 3:return s=e.sent,r&&this._logMessage(s.ts,s.channel,s.message.text),e.abrupt("return",s);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"editMessage",value:function(){var e=Object(h.a)(l.a.mark((function e(t,n,r,s){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.slackClient.chat.update({channel:t,ts:n,text:r}),s&&this._updateLogMessage(s,t,n,r);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r,s){return e.apply(this,arguments)}}()},{key:"deleteMessage",value:function(){var e=Object(h.a)(l.a.mark((function e(t,n,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.slackClient.chat.delete({channel:t,ts:n}),!r){e.next=4;break}return e.next=4,this._deleteLogMessage(r);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"scheduleMessage",value:function(){var e=Object(h.a)(l.a.mark((function e(t,n,r){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.chat.scheduleMessage({channel:n,text:t,post_at:r}).catch((function(e){console.error(e,{channel:n,text:t,post_at:r}),alert("Unable to schedule message. Review the error message in the console.")}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"deleteScheduledMessage",value:function(){var e=Object(h.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.chat.deleteScheduledMessage({scheduled_message_id:t,channel:n}).catch((function(e){console.error(e,{scheduled_message_id:t,channel:n}),alert("Unable to delete scheduled message. Review the error message in the console.")}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateScheduledMessage",value:function(){var e=Object(h.a)(l.a.mark((function e(t,n,r,s){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deleteScheduledMessage(t,n);case 2:return e.next=4,this.scheduleMessage(r,n,s);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,s){return e.apply(this,arguments)}}()},{key:"getScheduledMessages",value:function(){var e=Object(h.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.chat.scheduledMessages.list();case 2:return t=e.sent,n=t.scheduled_messages.sort((function(e,t){return e.post_at-t.post_at})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadLog",value:function(){var e=Object(h.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.conversations.history({channel:this.logChannel});case 2:return t=e.sent,n=t.messages.reduce((function(e,t){try{var n=t.text,r=t.ts;return e.push({messageDetails:JSON.parse(n),log_ts:r}),e}catch(s){return e}}),[]),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_logMessage",value:function(){var e=Object(h.a)(l.a.mark((function e(t,n,r){var s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s={text:r,ts:t,channel:n},this.postMessage(JSON.stringify(s),this.userId,!1);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_updateLogMessage",value:function(){var e=Object(h.a)(l.a.mark((function e(t,n,r,s){var c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c={channel:n,ts:r,text:s},this.editMessage(this.logChannel,t,JSON.stringify(c));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r,s){return e.apply(this,arguments)}}()},{key:"_deleteLogMessage",value:function(){var e=Object(h.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.chat.delete({channel:this.logChannel,ts:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getLogChannel",value:function(){var e=Object(h.a)(l.a.mark((function e(){var t,n,r=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.conversations.list({types:"im"});case 2:if(t=e.sent,n=t.channels.reduce((function(e,t){return t.user===r.userId?t.id:e}),null)){e.next=8;break}return e.next=7,this.postMessage("Starting message history",this.userId,!1);case 7:n=e.sent.channel;case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"validateToken",value:function(){var e=Object(h.a)(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.auth.test().catch((function(e){return Promise.reject("Invalid token: '".concat(t.slackClient.token,"'"))}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWorkspace",value:function(){var e=Object(h.a)(l.a.mark((function e(){var t,n,r,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.slackClient.conversations.list().then((function(e){return{channels:e.channels.map((function(e){return{id:e.id,name:e.name}})).sort((function(e,t){return e.name>t.name?1:-1})).reduce((function(e,t){return e[t.id]=Object(i.a)({},t),e}),{})}})),this.slackClient.team.info().then((function(e){return{team:{name:e.team.name,icon:e.team.icon.image_230}}}))]);case 2:return t=e.sent,n=Object(d.a)(t,2),r=n[0],s=n[1],e.abrupt("return",Object(i.a)(Object(i.a)({},r),s));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}());n(66);var w=function(e){var t=e.messages,n=e.onUpdateMessage,s=e.onDeleteMessage,c=e.showIdCol,a=void 0!==c&&c,i=Object(r.useContext)(b).workspace,u=Object(r.useState)(""),o=Object(d.a)(u,2),l=o[0],h=o[1],j=Object(r.useRef)(null),f=function(e){var t=e.messageDetails,r=t.channel,c=t.ts,u=t.text,o=e.log_ts,d=l===o;return Object(p.jsxs)("tr",{children:[a&&Object(p.jsx)("td",{children:o}),Object(p.jsxs)("td",{children:["#",i&&i.channels[r].name]}),Object(p.jsx)("td",{children:new Date(1e3*c).toLocaleString()}),Object(p.jsx)("td",{children:c}),Object(p.jsx)("td",{children:Object(p.jsx)("textarea",{defaultValue:u,readOnly:!d,ref:d?j:null})}),Object(p.jsx)("td",{children:d?Object(p.jsxs)("div",{children:[Object(p.jsx)("button",{onClick:function(){!function(e){j.current.value=e,h("")}(u)},children:"Cancel"}),Object(p.jsx)("button",{onClick:function(){!function(e){var t=j.current.value;n(e,t),h("")}(e)},children:"Update"})]}):Object(p.jsx)("button",{onClick:function(){h(o)},children:"Edit"})}),Object(p.jsx)("td",{children:Object(p.jsx)("button",{onClick:function(){s(e)},children:"Delete"})})]},o)};return Object(p.jsx)("table",{children:Object(p.jsxs)("tbody",{children:[Object(p.jsxs)("tr",{children:[a&&Object(p.jsx)("th",{children:"Id"}),Object(p.jsx)("th",{children:"Channel"}),Object(p.jsx)("th",{children:"Datetime"}),Object(p.jsx)("th",{children:"Timestamp"}),Object(p.jsx)("th",{children:"Text"}),Object(p.jsx)("th",{children:"Edit"}),Object(p.jsx)("th",{children:"Delete Message"})]}),t.map((function(e){return f(e)}))]})})};var y=function(){var e=Object(r.useContext)(b).workspace,t=Object(r.useState)([]),n=Object(d.a)(t,2),s=n[0],c=n[1];Object(r.useEffect)((function(){e&&a()}),[e]);var a=function(){k.loadLog().then((function(e){c(e)}))},i=function(){var e=Object(h.a)(l.a.mark((function e(t,n){var r,s,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.messageDetails,s=r.channel,c=r.ts,i=t.log_ts,e.next=3,k.editMessage(s,c,n,i);case 3:a();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),u=function(){var e=Object(h.a)(l.a.mark((function e(t){var n,r,s,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.messageDetails,r=n.channel,s=n.ts,c=t.log_ts,e.next=3,k.deleteMessage(r,s,c);case 3:a();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{children:[Object(p.jsx)("h1",{children:"Edit message"}),Object(p.jsx)("p",{children:"Select a message below to edit or delete."}),Object(p.jsx)("h3",{children:"Previous Messages"}),Object(p.jsx)(w,{messages:s,onUpdateMessage:i,onDeleteMessage:u})]})};var M=function(){return Object(p.jsxs)("div",{children:[Object(p.jsx)("h1",{children:"Welcome to EventBot"}),Object(p.jsx)("p",{children:"Select an action on the left nav bar"})]})};n(140);var C=function(e){var t=e.submitAction,n=Object(r.useContext)(b).workspace,s=n?Object.values(n.channels).map((function(e){return Object(i.a)({},e)})):null,c=Object(r.useRef)(null),a=Object(r.useRef)(null);return Object(p.jsx)("div",{className:"message-sender",children:Object(p.jsxs)("form",{onSubmit:function(e){e.preventDefault();var n=c.current.value,r=a.current.value;n&&(t(n,r),c.current.value="")},children:[Object(p.jsx)("textarea",{type:"text",ref:c}),Object(p.jsxs)("div",{children:[Object(p.jsx)("select",{defaultValue:s?s[0].id:"",ref:a,children:s&&s.map((function(e,t){return Object(p.jsx)("option",{value:e.id,children:e.name},t)}))}),Object(p.jsx)("input",{type:"submit"})]})]})})},S=(n(141),n(69)),_=n(36);function D(e){return Date.parse(e)/1e3}var I=function(e){var t=new Date;t.setSeconds(0);var n=Object(r.useState)(t),s=Object(d.a)(n,2),c=s[0],a=s[1],i=Object(r.useState)(D(t)),u=Object(d.a)(i,2),o=u[0],l=u[1],h=function(n){if(null==n||isNaN(n))a(t),l(D(t));else{var r=D(n);a(n),l(r),e.setParentTimestamp(r)}};return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(S.a,{value:c,valueEditFormat:{dateStyle:"short"},valueDisplayFormat:{dateStyle:"short"},onChange:function(e){return h(e)}}),Object(p.jsx)(_.a,{value:c,precision:"seconds",use12HourClock:!0,onChange:function(e){return h(e)}}),Object(p.jsxs)("h4",{children:["Timestamp: ",o]})]})};var L=function(){var e=Object(r.useContext)(b).workspace,t=Object(r.useState)([]),n=Object(d.a)(t,2),s=n[0],c=n[1],a=Object(r.useState)(null),i=Object(d.a)(a,2),u=i[0],o=i[1];Object(r.useEffect)((function(){e&&j()}),[e]);var j=function(){k.getScheduledMessages().then((function(e){var t=e.map((function(e){return{messageDetails:{channel:e.channel_id,ts:e.post_at,text:e.text},log_ts:e.id}}));c(t)}))},f=function(){var e=Object(h.a)(l.a.mark((function e(t,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.scheduleMessage(t,n,u);case 2:j();case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),O=function(){var e=Object(h.a)(l.a.mark((function e(t,n){var r,s,c,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.messageDetails,s=r.channel,c=r.ts,a=t.log_ts,e.next=3,k.updateScheduledMessage(a,s,n,c);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),x=function(){var e=Object(h.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.messageDetails.channel,r=t.log_ts,e.next=3,k.deleteScheduledMessage(r,n);case 3:j();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{children:[Object(p.jsx)("h1",{children:"Schedule message"}),Object(p.jsx)("div",{className:"datepicker-container",children:Object(p.jsx)(I,{setParentTimestamp:o})}),Object(p.jsx)(C,{submitAction:f}),Object(p.jsx)("h3",{children:"Scheduled Messages"}),Object(p.jsx)(w,{messages:s,onUpdateMessage:O,onDeleteMessage:x,showIdCol:!0})]})};var E=function(){return Object(p.jsxs)("div",{children:[Object(p.jsx)("h1",{children:"Send message"}),Object(p.jsx)(C,{submitAction:function(e,t){k.postMessage(e,t)}})]})},N=["loggedIn","children","component","render"];function T(e){var t=e.loggedIn,n=e.children,r=e.component,s=e.render,c=Object(u.a)(e,N);return Object(p.jsx)(j.b,Object(i.a)(Object(i.a)({},c),{},{render:function(){if(!1===t)return Object(p.jsx)(j.a,{to:"/login"});var e=r;return n||Object(p.jsx)(e,{})||s()}}))}var U=function(){var e=Object(r.useState)(null),t=Object(d.a)(e,2),n=t[0],s=t[1],c=Object(r.useState)(),a=Object(d.a)(c,2),i=a[0],u=a[1],o=Object(r.useCallback)(function(){var e=Object(h.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.init(t);case 3:return e.t0=u,e.next=6,k.loadWorkspace();case 6:return e.t1=e.sent,(0,e.t0)(e.t1),s(!0),localStorage.setItem("slackToken",t),e.abrupt("return",!0);case 13:return e.prev=13,e.t2=e.catch(0),s(!1),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),[]);return Object(r.useEffect)((function(){var e=localStorage.slackToken;e?o(e):s(!1)}),[o]),Object(p.jsx)("div",{className:"App",children:Object(p.jsxs)(b.Provider,{value:{workspace:i},children:[Object(p.jsx)(O,{onLogout:function(){localStorage.removeItem("slackToken"),s(!1),u()}}),Object(p.jsx)("div",{className:"content",children:Object(p.jsxs)(j.d,{children:[Object(p.jsx)(T,{loggedIn:n,exact:!0,path:"/",component:M}),Object(p.jsx)(T,{loggedIn:n,path:"/sendMessage",children:Object(p.jsx)(E,{})}),Object(p.jsx)(T,{loggedIn:n,path:"/scheduleMessage",children:Object(p.jsx)(L,{})}),Object(p.jsx)(T,{loggedIn:n,path:"/editMessage",children:Object(p.jsx)(y,{})}),Object(p.jsx)(j.b,{path:"/login",render:function(){return n?Object(p.jsx)(j.a,{to:"/"}):Object(p.jsx)(x,{login:o})}})]})})]})})};a.a.render(Object(p.jsx)(s.a.StrictMode,{children:Object(p.jsx)(f.a,{children:Object(p.jsx)(U,{})})}),document.getElementById("root"))},66:function(e,t,n){},75:function(e,t,n){},77:function(e,t,n){},78:function(e,t,n){},84:function(e,t,n){}},[[142,1,2]]]);
//# sourceMappingURL=main.97fd1a6c.chunk.js.map