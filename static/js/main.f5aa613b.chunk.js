(this.webpackJsonpeventbot=this.webpackJsonpeventbot||[]).push([[0],{125:function(e,t,n){"use strict";n.r(t);var s=n(1),c=n.n(s),r=n(50),a=n.n(r),i=(n(58),n(2)),u=n.n(i),l=n(4),o=n(9),h=(n(60),n(3)),j=(n(61),n(11)),d=Object(s.createContext)(null),b=n(0);var f=function(e){var t=e.onLogout,n=Object(s.useContext)(d).workspace;return Object(b.jsxs)("div",{className:"nav-bar",children:[Object(b.jsx)("h1",{children:"EventBot"}),n&&Object(b.jsxs)("div",{children:[Object(b.jsxs)("div",{className:"workspace",children:[Object(b.jsx)("h3",{children:n.team.name}),Object(b.jsx)("button",{onClick:t,children:"Log Out"})]}),Object(b.jsxs)("ul",{children:[Object(b.jsx)("li",{children:Object(b.jsx)(j.b,{to:"/",children:"Home"})}),Object(b.jsx)("li",{children:Object(b.jsx)(j.b,{to:"/sendMessage",children:"Send Message"})}),Object(b.jsx)("li",{children:Object(b.jsx)(j.b,{to:"/scheduleMessage",children:"Schedule Message"})}),Object(b.jsx)("li",{children:Object(b.jsx)(j.b,{to:"/editMessage",children:"Edit Message"})})]})]})]})};n(67);var p=function(e){var t=e.onSubmit;return Object(b.jsxs)("div",{children:[Object(b.jsx)("h1",{children:"Enter Slack Token"}),Object(b.jsxs)("form",{onSubmit:t,children:[Object(b.jsx)("input",{type:"password"}),Object(b.jsx)("input",{type:"submit"})]})]})},x=n(14),O=n(52),v=n(53),m=function(){function e(t){Object(O.a)(this,e),this.slackClient=t}return Object(v.a)(e,[{key:"init",value:function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.validateToken();case 2:return t=e.sent,this.userId=t.user_id,e.next=6,this.getMessageHistoryChannel();case 6:this.messageHistoryId=e.sent;case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"postMessage",value:function(){var e=Object(l.a)(u.a.mark((function e(t,n){var s,c,r=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=!(r.length>2&&void 0!==r[2])||r[2],e.next=3,this.slackClient.chat.postMessage({text:t,channel:n}).catch((function(e){console.error(e,{channel:n,message:t}),alert(e+"\n\nSee the full error message in the console.")}));case 3:return c=e.sent,s&&this.saveMessageDetails(c),e.abrupt("return",c);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"scheduleMessage",value:function(){var e=Object(l.a)(u.a.mark((function e(t,n,s){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.chat.scheduleMessage({channel:n,text:t,post_at:s}).catch((function(e){console.error(e,{channel:n,text:t,post_at:s}),alert("Unable to schedule message. Review the error message in the console.")}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,s){return e.apply(this,arguments)}}()},{key:"getScheduledMessages",value:function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.chat.scheduledMessages.list();case 2:return t=e.sent,e.abrupt("return",t.scheduled_messages);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteScheduledMessage",value:function(){var e=Object(l.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.chat.deleteScheduledMessage({scheduled_message_id:t,channel:n}).catch((function(e){console.error(e,{scheduled_message_id:t,channel:n}),alert("Unable to delete scheduled message. Review the error message in the console.")}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getMessageHistoryChannel",value:function(){var e=Object(l.a)(u.a.mark((function e(){var t,n,s=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.conversations.list({types:"im"});case 2:if(t=e.sent,n=t.channels.reduce((function(e,t){return t.user===s.userId?t.id:e}),null)){e.next=8;break}return e.next=7,this.postMessage("Starting message history",this.userId,!1);case 7:n=e.sent.channel;case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadPrevMessages",value:function(){var e=Object(l.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.conversations.history({channel:this.messageHistoryId});case 2:return t=e.sent,n=t.messages.reduce((function(e,t){try{var n=t.text,s=t.ts;return e.push({messageDetails:JSON.parse(n),log_ts:s}),e}catch(c){return e}}),[]),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"saveMessageDetails",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={text:t.message.text,ts:t.ts,channel:t.channel},this.postMessage(JSON.stringify(n),this.userId,!1);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"editMessage",value:function(){var e=Object(l.a)(u.a.mark((function e(t,n,s,c){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.slackClient.chat.update({channel:t,ts:n,text:s}),c&&(r={text:s,ts:n,channel:t},this.slackClient.chat.update({channel:this.messageHistoryId,ts:c,text:JSON.stringify(r)}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,s,c){return e.apply(this,arguments)}}()},{key:"deleteMessage",value:function(){var e=Object(l.a)(u.a.mark((function e(t,n,s){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.slackClient.chat.delete({channel:t,ts:n}),!s){e.next=4;break}return e.next=4,this.slackClient.chat.delete({channel:this.messageHistoryId,ts:s});case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,s){return e.apply(this,arguments)}}()},{key:"validateToken",value:function(){var e=Object(l.a)(u.a.mark((function e(){var t=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.auth.test().catch((function(e){return Promise.reject("Invalid token: '".concat(t.slackClient.token,"'"))}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWorkspace",value:function(){var e=Object(l.a)(u.a.mark((function e(){var t,n,s,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.slackClient.conversations.list().then((function(e){return{channels:e.channels.map((function(e){return{id:e.id,name:e.name}})).sort((function(e,t){return e.name>t.name?1:-1})).reduce((function(e,t){return e[t.id]=Object(x.a)({},t),e}),{})}})),this.slackClient.team.info().then((function(e){return{team:{name:e.team.name,icon:e.team.icon.image_230}}}))]);case 2:return t=e.sent,n=Object(o.a)(t,2),s=n[0],c=n[1],e.abrupt("return",Object(x.a)(Object(x.a)({},s),c));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();n(68);var g=function(e){var t=e.submitAction,n=Object(s.useContext)(d).workspace,c=n?Object.values(n.channels).map((function(e){return Object(x.a)({},e)})):null,r=Object(s.useRef)(null),a=Object(s.useRef)(null);return Object(b.jsx)("div",{className:"message-sender",children:Object(b.jsxs)("form",{onSubmit:function(e){e.preventDefault();var n=r.current.value,s=a.current.value;n&&(t(n,s),r.current.value="")},children:[Object(b.jsx)("textarea",{type:"text",ref:r}),Object(b.jsxs)("div",{children:[Object(b.jsx)("select",{defaultValue:c?c[0].id:"",ref:a,children:c&&c.map((function(e,t){return Object(b.jsx)("option",{value:e.id,children:e.name},t)}))}),Object(b.jsx)("input",{type:"submit"})]})]})})};var k=function(){var e=Object(s.useContext)(d).slackClient;return Object(b.jsxs)("div",{children:[Object(b.jsx)("h1",{children:"Send message"}),Object(b.jsx)(g,{submitAction:function(t,n){e.postMessage(t,n)}})]})};var y=function(){return Object(b.jsxs)("div",{children:[Object(b.jsx)("h1",{children:"Welcome to EventBot"}),Object(b.jsx)("p",{children:"Select an action on the left nav bar"})]})};n(30);var w=function(){var e=Object(s.useContext)(d),t=e.slackClient,n=e.workspace,c=e.isLoading,r=Object(s.useState)([]),a=Object(o.a)(r,2),i=a[0],h=a[1],j=Object(s.useRef)(null);Object(s.useEffect)((function(){c||f()}),[c]);var f=function(){t.getScheduledMessages().then((function(e){h(e)}))},p=function(){var e=Object(l.a)(u.a.mark((function e(n,s){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.scheduleMessage(n,s,j.current.value);case 2:f();case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),x=function(){var e=Object(l.a)(u.a.mark((function e(n,s){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.deleteScheduledMessage(n,s);case 2:f();case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return Object(b.jsxs)("div",{children:[Object(b.jsx)("h1",{children:"Schedule message"}),Object(b.jsx)("input",{ref:j,placeholder:"Epoch time"}),Object(b.jsx)(g,{submitAction:p}),Object(b.jsx)("h3",{children:"Scheduled Messages"}),Object(b.jsx)("table",{children:Object(b.jsxs)("tbody",{children:[Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{children:"ID"}),Object(b.jsx)("th",{children:"Channel"}),Object(b.jsx)("th",{children:"Post At"}),Object(b.jsx)("th",{children:"Text"}),Object(b.jsx)("th",{children:"Delete Message"})]}),i.map((function(e){var t=e.id,s=e.channel_id,c=e.post_at,r=e.text;return Object(b.jsxs)("tr",{children:[Object(b.jsx)("td",{children:t}),Object(b.jsxs)("td",{children:["#",n&&n.channels[s].name]}),Object(b.jsx)("td",{children:c}),Object(b.jsx)("td",{children:Object(b.jsx)("pre",{children:r})}),Object(b.jsx)("td",{children:Object(b.jsx)("button",{onClick:function(){x(t,s)},children:"Delete"})})]},t)}))]})})]})};var M=function(){var e=Object(s.useContext)(d),t=e.slackClient,n=e.workspace,c=e.isLoading,r=Object(s.useState)([]),a=Object(o.a)(r,2),i=a[0],h=a[1],j=Object(s.useState)(""),f=Object(o.a)(j,2),p=f[0],x=f[1],O=Object(s.useRef)(null);Object(s.useEffect)((function(){c||v()}),[c]);var v=function(){t.loadPrevMessages().then((function(e){h(e)}))},m=function(){var e=Object(l.a)(u.a.mark((function e(n){var s,c,r,a,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.messageDetails,c=s.channel,r=s.ts,a=n.log_ts,i=O.current.value,e.next=4,t.editMessage(c,r,i,a);case 4:x(""),v();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=Object(l.a)(u.a.mark((function e(n){var s,c,r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.messageDetails,c=s.channel,r=s.ts,a=n.log_ts,e.next=3,t.deleteMessage(c,r,a);case 3:v();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(b.jsxs)("div",{children:[Object(b.jsx)("h1",{children:"Edit message"}),Object(b.jsx)("p",{children:"Select a message below to edit or delete."}),Object(b.jsx)("h3",{children:"Previous Messages"}),Object(b.jsx)("table",{children:Object(b.jsxs)("tbody",{children:[Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{children:"Channel"}),Object(b.jsx)("th",{children:"Timestamp"}),Object(b.jsx)("th",{children:"Text"}),Object(b.jsx)("th",{children:"Edit"}),Object(b.jsx)("th",{children:"Delete Message"})]}),i.map((function(e){var t=e.messageDetails,s=t.channel,c=t.ts,r=t.text,a=e.log_ts,i=p===a;return Object(b.jsxs)("tr",{children:[Object(b.jsxs)("td",{children:["#",n&&n.channels[s].name]}),Object(b.jsx)("td",{children:c}),Object(b.jsx)("td",{children:Object(b.jsx)("textarea",{defaultValue:r,readOnly:!i,ref:i?O:null})}),Object(b.jsx)("td",{children:i?Object(b.jsxs)("div",{children:[Object(b.jsx)("button",{onClick:function(){!function(e){O.current.value=e,x("")}(r)},children:"Cancel"}),Object(b.jsx)("button",{onClick:function(){m(e)},children:"Update"})]}):Object(b.jsx)("button",{onClick:function(){x(a)},children:"Edit"})}),Object(b.jsx)("td",{children:Object(b.jsx)("button",{onClick:function(){g(e)},children:"Delete"})})]},a)}))]})})]})},C=n(69).WebClient;var S=function(){var e=Object(s.useState)(localStorage.slackToken),t=Object(o.a)(e,2),n=t[0],c=t[1],r=Object(s.useState)(!0),a=Object(o.a)(r,2),i=a[0],j=a[1],x=Object(s.useState)(),O=Object(o.a)(x,2),v=O[0],g=O[1],S=Object(s.useState)(),_=Object(o.a)(S,2),D=_[0],I=_[1],E=Object(h.e)(),T=Object(h.f)();Object(s.useEffect)((function(){n?(localStorage.setItem("slackToken",n),N()):(localStorage.removeItem("slackToken"),E.push("/login"))}),[n]);var N=function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=new m(new C(n)),e.next=4,t.init();case 4:return g(t),e.t0=I,e.next=8,t.loadWorkspace();case 8:e.t1=e.sent,(0,e.t0)(e.t1),j(!1),"/login"===T.pathname&&E.push("/"),e.next=18;break;case 14:e.prev=14,e.t2=e.catch(0),c(),alert(e.t2);case 18:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(){return e.apply(this,arguments)}}(),H=function(e){e.preventDefault(),c(e.target[0].value),e.target[0].value=""};return Object(b.jsx)("div",{className:"App",children:Object(b.jsxs)(d.Provider,{value:{slackClient:v,workspace:D,isLoading:i},children:[Object(b.jsx)(f,{onLogout:function(){c(),I()}}),Object(b.jsxs)("div",{className:"content",children:[Object(b.jsx)(h.a,{exact:!0,path:"/",component:y}),Object(b.jsx)(h.a,{path:"/sendMessage",component:k}),Object(b.jsx)(h.a,{path:"/scheduleMessage",component:w}),Object(b.jsx)(h.a,{path:"/editMessage",component:M}),Object(b.jsx)(h.a,{path:"/login",render:function(){return Object(b.jsx)(p,{onSubmit:H})}})]})]})})};a.a.render(Object(b.jsx)(c.a.StrictMode,{children:Object(b.jsx)(j.a,{children:Object(b.jsx)(S,{})})}),document.getElementById("root"))},30:function(e,t,n){},58:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){},67:function(e,t,n){},68:function(e,t,n){}},[[125,1,2]]]);
//# sourceMappingURL=main.f5aa613b.chunk.js.map