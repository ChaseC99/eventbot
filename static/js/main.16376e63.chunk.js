(this.webpackJsonpeventbot=this.webpackJsonpeventbot||[]).push([[0],{139:function(e,t,n){},141:function(e,t,n){"use strict";n.r(t);var s=n(0),a=n.n(s),r=n(27),c=n.n(r),i=(n(74),n(4)),u=n.n(i),o=n(8),l=n(5),h=(n(76),n(9)),d=(n(77),n(21)),j=Object(s.createContext)(null),f=n(2);var p=function(e){var t=e.onLogout,n=Object(s.useContext)(j).workspace;return Object(f.jsxs)("div",{className:"nav-bar",children:[Object(f.jsx)("h1",{children:"EventBot"}),n&&Object(f.jsxs)("div",{children:[Object(f.jsxs)("div",{className:"workspace",children:[Object(f.jsx)("h3",{children:n.team.name}),Object(f.jsx)("button",{onClick:t,children:"Log Out"})]}),Object(f.jsxs)("ul",{children:[Object(f.jsx)("li",{children:Object(f.jsx)(d.b,{to:"/",children:"Home"})}),Object(f.jsx)("li",{children:Object(f.jsx)(d.b,{to:"/sendMessage",children:"Send Message"})}),Object(f.jsx)("li",{children:Object(f.jsx)(d.b,{to:"/scheduleMessage",children:"Schedule Message"})}),Object(f.jsx)("li",{children:Object(f.jsx)(d.b,{to:"/editMessage",children:"Edit Message"})})]})]})]})};n(83);var b=function(e){var t=e.onSubmit;return Object(f.jsxs)("div",{children:[Object(f.jsx)("h1",{children:"Enter Slack Token"}),Object(f.jsxs)("form",{onSubmit:t,children:[Object(f.jsx)("input",{type:"password"}),Object(f.jsx)("input",{type:"submit"})]})]})},x=n(28),v=n(17),O=n(18),g=n(68),m=new(function(){function e(){Object(v.a)(this,e)}return Object(O.a)(e,[{key:"init",value:function(){var e=Object(o.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.slackClient=new g.WebClient(t),delete this.slackClient.axios.defaults.headers["User-Agent"],e.next=4,this.validateToken();case 4:return n=e.sent,this.userId=n.user_id,e.next=8,this._getLogChannel();case 8:this.logChannel=e.sent;case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){delete this.slackClient}},{key:"postMessage",value:function(){var e=Object(o.a)(u.a.mark((function e(t,n){var s,a,r=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=!(r.length>2&&void 0!==r[2])||r[2],e.next=3,this.slackClient.chat.postMessage({text:t,channel:n}).catch((function(e){console.error(e,{channel:n,message:t}),alert(e+"\n\nSee the full error message in the console.")}));case 3:return a=e.sent,s&&this._logMessage(a.ts,a.channel,a.message.text),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"editMessage",value:function(){var e=Object(o.a)(u.a.mark((function e(t,n,s,a){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.slackClient.chat.update({channel:t,ts:n,text:s}),a&&this._updateLogMessage(a,t,n,s);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,s,a){return e.apply(this,arguments)}}()},{key:"deleteMessage",value:function(){var e=Object(o.a)(u.a.mark((function e(t,n,s){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.slackClient.chat.delete({channel:t,ts:n}),!s){e.next=4;break}return e.next=4,this._deleteLogMessage(s);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,s){return e.apply(this,arguments)}}()},{key:"scheduleMessage",value:function(){var e=Object(o.a)(u.a.mark((function e(t,n,s){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.chat.scheduleMessage({channel:n,text:t,post_at:s}).catch((function(e){console.error(e,{channel:n,text:t,post_at:s}),alert("Unable to schedule message. Review the error message in the console.")}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,s){return e.apply(this,arguments)}}()},{key:"deleteScheduledMessage",value:function(){var e=Object(o.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.chat.deleteScheduledMessage({scheduled_message_id:t,channel:n}).catch((function(e){console.error(e,{scheduled_message_id:t,channel:n}),alert("Unable to delete scheduled message. Review the error message in the console.")}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateScheduledMessage",value:function(){var e=Object(o.a)(u.a.mark((function e(t,n,s,a){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deleteScheduledMessage(t,n);case 2:return e.next=4,this.scheduleMessage(s,n,a);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,s,a){return e.apply(this,arguments)}}()},{key:"getScheduledMessages",value:function(){var e=Object(o.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.chat.scheduledMessages.list();case 2:return t=e.sent,e.abrupt("return",t.scheduled_messages);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadLog",value:function(){var e=Object(o.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.conversations.history({channel:this.logChannel});case 2:return t=e.sent,n=t.messages.reduce((function(e,t){try{var n=t.text,s=t.ts;return e.push({messageDetails:JSON.parse(n),log_ts:s}),e}catch(a){return e}}),[]),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_logMessage",value:function(){var e=Object(o.a)(u.a.mark((function e(t,n,s){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={text:s,ts:t,channel:n},this.postMessage(JSON.stringify(a),this.userId,!1);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,s){return e.apply(this,arguments)}}()},{key:"_updateLogMessage",value:function(){var e=Object(o.a)(u.a.mark((function e(t,n,s,a){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={channel:n,ts:s,text:a},this.editMessage(this.logChannel,t,JSON.stringify(r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,s,a){return e.apply(this,arguments)}}()},{key:"_deleteLogMessage",value:function(){var e=Object(o.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.chat.delete({channel:this.logChannel,ts:t});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getLogChannel",value:function(){var e=Object(o.a)(u.a.mark((function e(){var t,n,s=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.conversations.list({types:"im"});case 2:if(t=e.sent,n=t.channels.reduce((function(e,t){return t.user===s.userId?t.id:e}),null)){e.next=8;break}return e.next=7,this.postMessage("Starting message history",this.userId,!1);case 7:n=e.sent.channel;case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"validateToken",value:function(){var e=Object(o.a)(u.a.mark((function e(){var t=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.slackClient.auth.test().catch((function(e){return Promise.reject("Invalid token: '".concat(t.slackClient.token,"'"))}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWorkspace",value:function(){var e=Object(o.a)(u.a.mark((function e(){var t,n,s,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.slackClient.conversations.list().then((function(e){return{channels:e.channels.map((function(e){return{id:e.id,name:e.name}})).sort((function(e,t){return e.name>t.name?1:-1})).reduce((function(e,t){return e[t.id]=Object(x.a)({},t),e}),{})}})),this.slackClient.team.info().then((function(e){return{team:{name:e.team.name,icon:e.team.icon.image_230}}}))]);case 2:return t=e.sent,n=Object(l.a)(t,2),s=n[0],a=n[1],e.abrupt("return",Object(x.a)(Object(x.a)({},s),a));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}());n(139);var k=function(e){var t=e.submitAction,n=Object(s.useContext)(j).workspace,a=n?Object.values(n.channels).map((function(e){return Object(x.a)({},e)})):null,r=Object(s.useRef)(null),c=Object(s.useRef)(null);return Object(f.jsx)("div",{className:"message-sender",children:Object(f.jsxs)("form",{onSubmit:function(e){e.preventDefault();var n=r.current.value,s=c.current.value;n&&(t(n,s),r.current.value="")},children:[Object(f.jsx)("textarea",{type:"text",ref:r}),Object(f.jsxs)("div",{children:[Object(f.jsx)("select",{defaultValue:a?a[0].id:"",ref:c,children:a&&a.map((function(e,t){return Object(f.jsx)("option",{value:e.id,children:e.name},t)}))}),Object(f.jsx)("input",{type:"submit"})]})]})})};var w=function(){return Object(f.jsxs)("div",{children:[Object(f.jsx)("h1",{children:"Send message"}),Object(f.jsx)(k,{submitAction:function(e,t){m.postMessage(e,t)}})]})};var y=function(){return Object(f.jsxs)("div",{children:[Object(f.jsx)("h1",{children:"Welcome to EventBot"}),Object(f.jsx)("p",{children:"Select an action on the left nav bar"})]})},M=(n(66),n(140),n(69)),C=n(36);function S(e){return Date.parse(e)/1e3}var _=function(e){var t=new Date;t.setSeconds(0);var n=Object(s.useState)(t),a=Object(l.a)(n,2),r=a[0],c=a[1],i=Object(s.useState)(S(t)),u=Object(l.a)(i,2),o=u[0],h=u[1],d=function(n){if(null==n||isNaN(n))c(t),h(S(t));else{var s=S(n);c(n),h(s),e.setParentTimestamp(s)}};return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(M.a,{value:r,valueEditFormat:{dateStyle:"short"},valueDisplayFormat:{dateStyle:"short"},onChange:function(e){return d(e)}}),Object(f.jsx)(C.a,{value:r,precision:"seconds",use12HourClock:!0,onChange:function(e){return d(e)}}),Object(f.jsxs)("h4",{children:["Timestamp: ",o]})]})};var D=function(e){var t=e.messages,n=e.onUpdateMessage,a=e.onDeleteMessage,r=e.showIdCol,c=void 0!==r&&r,i=Object(s.useContext)(j).workspace,u=Object(s.useState)(""),o=Object(l.a)(u,2),h=o[0],d=o[1],p=Object(s.useRef)(null),b=function(e){var t=e.messageDetails,s=t.channel,r=t.ts,u=t.text,o=e.log_ts,l=h===o;return Object(f.jsxs)("tr",{children:[c&&Object(f.jsx)("td",{children:o}),Object(f.jsxs)("td",{children:["#",i&&i.channels[s].name]}),Object(f.jsx)("td",{children:r}),Object(f.jsx)("td",{children:Object(f.jsx)("textarea",{defaultValue:u,readOnly:!l,ref:l?p:null})}),Object(f.jsx)("td",{children:l?Object(f.jsxs)("div",{children:[Object(f.jsx)("button",{onClick:function(){!function(e){p.current.value=e,d("")}(u)},children:"Cancel"}),Object(f.jsx)("button",{onClick:function(){!function(e){var t=p.current.value;n(e,t),d("")}(e)},children:"Update"})]}):Object(f.jsx)("button",{onClick:function(){d(o)},children:"Edit"})}),Object(f.jsx)("td",{children:Object(f.jsx)("button",{onClick:function(){a(e)},children:"Delete"})})]},o)};return Object(f.jsx)("table",{children:Object(f.jsxs)("tbody",{children:[Object(f.jsxs)("tr",{children:[c&&Object(f.jsx)("th",{children:"Id"}),Object(f.jsx)("th",{children:"Channel"}),Object(f.jsx)("th",{children:"Timestamp"}),Object(f.jsx)("th",{children:"Text"}),Object(f.jsx)("th",{children:"Edit"}),Object(f.jsx)("th",{children:"Delete Message"})]}),t.map((function(e){return b(e)}))]})})};var L=function(){var e=Object(s.useContext)(j).isLoading,t=Object(s.useState)([]),n=Object(l.a)(t,2),a=n[0],r=n[1],c=Object(s.useState)(null),i=Object(l.a)(c,2),h=i[0],d=i[1];Object(s.useEffect)((function(){e||p()}),[e]);var p=function(){m.getScheduledMessages().then((function(e){var t=e.map((function(e){return{messageDetails:{channel:e.channel_id,ts:e.post_at,text:e.text},log_ts:e.id}}));r(t)}))},b=function(){var e=Object(o.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.scheduleMessage(t,n,h);case 2:p();case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),x=function(){var e=Object(o.a)(u.a.mark((function e(t,n){var s,a,r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.messageDetails,a=s.channel,r=s.ts,c=t.log_ts,e.next=3,m.updateScheduledMessage(c,a,n,r);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),v=function(){var e=Object(o.a)(u.a.mark((function e(t){var n,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.messageDetails.channel,s=t.log_ts,e.next=3,m.deleteScheduledMessage(s,n);case 3:p();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(f.jsxs)("div",{children:[Object(f.jsx)("h1",{children:"Schedule message"}),Object(f.jsx)("div",{className:"datepicker-container",children:Object(f.jsx)(_,{setParentTimestamp:d})}),Object(f.jsx)(k,{submitAction:b}),Object(f.jsx)("h3",{children:"Scheduled Messages"}),Object(f.jsx)(D,{messages:a,onUpdateMessage:x,onDeleteMessage:v,showIdCol:!0})]})};var E=function(){var e=Object(s.useContext)(j).isLoading,t=Object(s.useState)([]),n=Object(l.a)(t,2),a=n[0],r=n[1];Object(s.useEffect)((function(){e||c()}),[e]);var c=function(){m.loadLog().then((function(e){r(e)}))},i=function(){var e=Object(o.a)(u.a.mark((function e(t,n){var s,a,r,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.messageDetails,a=s.channel,r=s.ts,i=t.log_ts,e.next=3,m.editMessage(a,r,n,i);case 3:c();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),h=function(){var e=Object(o.a)(u.a.mark((function e(t){var n,s,a,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.messageDetails,s=n.channel,a=n.ts,r=t.log_ts,e.next=3,m.deleteMessage(s,a,r);case 3:c();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(f.jsxs)("div",{children:[Object(f.jsx)("h1",{children:"Edit message"}),Object(f.jsx)("p",{children:"Select a message below to edit or delete."}),Object(f.jsx)("h3",{children:"Previous Messages"}),Object(f.jsx)(D,{messages:a,onUpdateMessage:i,onDeleteMessage:h})]})};var I=function(){var e=Object(s.useState)(localStorage.slackToken),t=Object(l.a)(e,2),n=t[0],a=t[1],r=Object(s.useState)(!0),c=Object(l.a)(r,2),i=c[0],d=c[1],x=Object(s.useState)(),v=Object(l.a)(x,2),O=v[0],g=v[1],k=Object(h.e)(),M=Object(h.f)();Object(s.useEffect)((function(){n?(localStorage.setItem("slackToken",n),C()):(localStorage.removeItem("slackToken"),k.push("/login"))}),[n]);var C=function(){var e=Object(o.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m.init(n);case 3:return e.t0=g,e.next=6,m.loadWorkspace();case 6:e.t1=e.sent,(0,e.t0)(e.t1),d(!1),"/login"===M.pathname&&k.push("/"),e.next=16;break;case 12:e.prev=12,e.t2=e.catch(0),a(),alert(e.t2);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}(),S=function(e){e.preventDefault(),a(e.target[0].value),e.target[0].value=""};return Object(f.jsx)("div",{className:"App",children:Object(f.jsxs)(j.Provider,{value:{workspace:O,isLoading:i},children:[Object(f.jsx)(p,{onLogout:function(){a(),g()}}),Object(f.jsxs)("div",{className:"content",children:[Object(f.jsx)(h.a,{exact:!0,path:"/",component:y}),Object(f.jsx)(h.a,{path:"/sendMessage",component:w}),Object(f.jsx)(h.a,{path:"/scheduleMessage",component:L}),Object(f.jsx)(h.a,{path:"/editMessage",component:E}),Object(f.jsx)(h.a,{path:"/login",render:function(){return Object(f.jsx)(b,{onSubmit:S})}})]})]})})};c.a.render(Object(f.jsx)(a.a.StrictMode,{children:Object(f.jsx)(d.a,{children:Object(f.jsx)(I,{})})}),document.getElementById("root"))},66:function(e,t,n){},74:function(e,t,n){},76:function(e,t,n){},77:function(e,t,n){},83:function(e,t,n){}},[[141,1,2]]]);
//# sourceMappingURL=main.16376e63.chunk.js.map