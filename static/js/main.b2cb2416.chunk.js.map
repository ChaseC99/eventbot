{"version":3,"sources":["AppContext.js","components/navbar/navbar.js","components/tokenInput/tokenInput.js","helpers/slack.js","components/messageInput/messageInput.js","views/sendMessage.js","views/home.js","views/scheduleMessage.js","App.js","index.js"],"names":["AppContext","createContext","NavBar","props","onLogout","workspace","useContext","className","team","name","onClick","to","TokenInput","onSubmit","type","SlackClient","webclient","this","slackClient","message","channel","chat","postMessage","text","catch","err","console","error","alert","post_at","a","scheduleMessage","scheduledMessages","list","resp","scheduled_messages","scheduled_message_id","deleteScheduledMessage","auth","test","Promise","reject","token","all","conversations","then","result","channels","map","id","sort","c1","c2","reduce","channelDict","info","icon","image_230","MessageInput","submitAction","Object","values","messageTextField","useRef","selectedChannel","event","preventDefault","current","value","ref","defaultValue","i","SendMessage","Home","ScheduleMessage","useState","setScheduledMessages","timeInput","useEffect","loadScheduledMessages","getScheduledMessages","messages","deleteMessage","messageId","channelId","placeholder","channel_id","WebClient","require","App","localStorage","setToken","setWorkspace","history","useHistory","location","useLocation","setItem","login","removeItem","push","validateToken","loadWorkspace","pathname","saveToken","target","Provider","exact","path","component","render","ReactDOM","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.b2cb2416.chunk.js","sourcesContent":["import {createContext} from 'react';\n\nconst AppContext = createContext(null);\n\nexport default AppContext;","import './navbar.css';\n\nimport {NavLink} from 'react-router-dom';\nimport { useContext } from 'react';\nimport AppContext from '../../AppContext';\n\nfunction NavBar(props) {\n  const { onLogout } = props;\n  const { workspace } = useContext(AppContext)\n\n  return (\n    <div className=\"nav-bar\">\n        <h1>EventBot</h1>\n        {workspace && \n            <div>\n                <div className=\"workspace\">\n                    <h3>{workspace.team.name}</h3>\n                    <button onClick={onLogout}>Log Out</button>\n                </div>\n                <ul>\n                    <li><NavLink to='/'>Home</NavLink></li>\n                    <li><NavLink to='/sendMessage'>Send Message</NavLink></li>\n                    <li><NavLink to='/scheduleMessage'>Schedule Message</NavLink></li>\n                </ul>\n            </div>\n        }\n    </div>\n  );\n}\n\nexport default NavBar;\n","import './tokenInput.css';\n\nfunction TokenInput(props) {\n    const {onSubmit} = props\n    return (\n        <div>\n            <h1>Enter Slack Token</h1>\n            <form onSubmit={onSubmit}>\n                <input type=\"password\" />\n                <input type=\"submit\" />\n            </form>\n        </div>\n    );\n}\n\nexport default TokenInput;\n","class SlackClient {\n    constructor(webclient) {\n        this.slackClient = webclient;\n    }\n\n    postMessage(message, channel) {\n        this.slackClient.chat.postMessage({ text: message, channel: channel }).catch((err) => {\n            console.error(err, {channel, message});\n            alert('Unable to post message. Review the error message in the console.');\n        })\n    }\n\n    async scheduleMessage(text, channel, post_at) {\n        await this.slackClient.chat.scheduleMessage({ channel, text, post_at }).catch((err) => {\n            console.error(err, {channel, text, post_at});\n            alert('Unable to schedule message. Review the error message in the console.');\n        })\n    }\n\n    async getScheduledMessages() {\n        const resp = await this.slackClient.chat.scheduledMessages.list();\n        return resp.scheduled_messages;\n    }\n\n    async deleteScheduledMessage(scheduled_message_id, channel) {\n        await this.slackClient.chat.deleteScheduledMessage({scheduled_message_id, channel}).catch((err) => {\n            console.error(err, {scheduled_message_id, channel});\n            alert('Unable to delete scheduled message. Review the error message in the console.');\n        });\n    }\n\n    async validateToken() {\n        await this.slackClient.auth.test().catch(err => {\n            return Promise.reject(`Invalid token: '${this.slackClient.token}'`)\n        })\n    }\n\n    async loadWorkspace() {    \n        const [channels, team] = await Promise.all([\n            // Load channels from Slack Workspace\n            // Set selected channel to the first channel in the list\n            this.slackClient.conversations.list()\n                .then(result => {\n                    const channels = result.channels\n                    .map(channel => ({id: channel.id, name: channel.name}))\n                    .sort((c1, c2) => (c1.name > c2.name) ? 1 : -1)\n                    .reduce((channelDict, channel) => {\n                        channelDict[channel.id] = {...channel};\n                        return channelDict;\n                    }, {});\n                    return {channels};\n                }\n            ),\n\n            // Load team information\n            this.slackClient.team.info()\n                .then(result => {\n                    return {team: {name: result.team.name, icon: result.team.icon.image_230}};\n                }\n            )\n        ])\n        \n        return {...channels, ...team }\n    }\n}\n\nexport default SlackClient;","import './messageInput.css';\n\nimport AppContext from '../../AppContext';\nimport {useRef, useContext} from 'react';\n\nfunction MessageInput(props) {\n  const {submitAction} = props;\n  \n  const { workspace } = useContext(AppContext);\n  const channels = workspace ? Object.values(workspace.channels).map(channel => { \n    return {...channel}\n  }) : null;\n  const messageTextField = useRef(null);\n  const selectedChannel = useRef(null)\n\n  const formSubmitted = event => {\n    event.preventDefault();\n\n    // Get message and channel\n    // Return early if either is blank\n    let message = messageTextField.current.value;\n    let channel = selectedChannel.current.value\n    if (!message) { return }\n\n    // Handle action\n    submitAction(message, channel);\n    \n    // Reset the textarea\n    messageTextField.current.value = '';\n  }\n\n  return (\n    <div className=\"message-sender\">\n        <form onSubmit={formSubmitted}>\n            <textarea type=\"text\" ref={messageTextField} />\n            <div>\n                <select defaultValue={channels ? channels[0].id : ''} ref={selectedChannel}>\n                    {channels && channels.map((channel, i) =>\n                    <option key={i} value={channel.id}>{channel.name}</option>\n                    )}\n                </select>\n                <input type=\"submit\" />\n            </div>\n        </form>\n    </div>\n    \n  );\n}\n\nexport default MessageInput;\n","import MessageInput from '../components/messageInput/messageInput'\nimport AppContext from '../AppContext';\nimport {useContext} from 'react';\n\nfunction SendMessage() {\n    const { slackClient } = useContext(AppContext);\n\n    const sendMessage = (message, channel) => {\n        slackClient.postMessage(message, channel);\n    }\n\n    return (\n        <div>\n            <h1>Send message</h1>\n            <MessageInput submitAction={sendMessage}/>\n        </div>\n    );\n}\n\nexport default SendMessage;\n","function Home() {\n    return (\n        <div>\n            <h1>Welcome to EventBot</h1>\n            <p>Select an action on the left nav bar</p>\n        </div>\n    );\n}\n\nexport default Home;\n","import './scheduleMessage.css';\n\nimport MessageInput from '../components/messageInput/messageInput'\nimport { useContext, useEffect, useRef, useState } from 'react';\nimport AppContext from '../AppContext';\n\nfunction ScheduleMessage() {\n    const {slackClient, workspace} = useContext(AppContext);\n    const [scheduledMessages, setScheduledMessages] = useState([]);\n    const timeInput = useRef(null)\n    \n    useEffect(()=>{\n        loadScheduledMessages();\n    }, [])\n\n    const loadScheduledMessages = () => {\n        slackClient.getScheduledMessages().then(messages => {\n            setScheduledMessages(messages);\n        })\n    }\n\n    const scheduleMessage = async (message, channel) => {\n        await slackClient.scheduleMessage(message, channel, timeInput.current.value);\n        loadScheduledMessages();\n    }\n\n    const deleteMessage = async (messageId, channelId) => {\n        await slackClient.deleteScheduledMessage(messageId, channelId);\n        loadScheduledMessages();\n    }\n\n    return (\n        <div>\n            <h1>Schedule message</h1>\n            <input ref={timeInput} placeholder=\"Epoch time\"/>\n            <MessageInput submitAction={scheduleMessage} />\n            <h3>Scheduled Messages</h3>\n            <table>\n                <tr>\n                    <th>ID</th>\n                    <th>Channel</th>\n                    <th>Post At</th>\n                    <th>Text</th>\n                    <th>Delete Message</th>\n                </tr>\n                {scheduledMessages.map(message => {\n                    const {id, channel_id, post_at, text} = message;\n\n                    return (\n                        <tr key={id}>\n                            <td>{id}</td>\n                            <td>#{workspace && workspace.channels[channel_id].name}</td>\n                            <td>{post_at}</td>\n                            <td><pre>{text}</pre></td>\n                            <td><button onClick={()=>{deleteMessage(id, channel_id)}}>Delete</button></td>\n                        </tr>\n                    )\n                })}        \n            </table>\n        </div>\n    );\n}\n\nexport default ScheduleMessage;\n","import './App.css';\nimport {\n  Route,\n  useHistory,\n  useLocation\n} from 'react-router-dom';\nimport {useEffect, useState} from 'react';\nimport NavBar from './components/navbar/navbar';\nimport AppContext from './AppContext';\nimport TokenInput from './components/tokenInput/tokenInput';\nimport SlackClient from './helpers/slack';\nimport SendMessage from './views/sendMessage';\nimport Home from './views/home';\nimport ScheduleMessage from './views/scheduleMessage';\n\nconst { WebClient } = require('@slack/web-api');\n\nfunction App() {\n  const [token, setToken] = useState(localStorage['slackToken']);\n  const [workspace, setWorkspace] = useState(); \n  const history = useHistory();\n  const location = useLocation();\n  \n  // Create WebClient to interface with Slack API\n  const slackClient = new SlackClient(new WebClient(token)); \n\n  useEffect(() => {\n    if (token) {\n      // Save Slack token to local storage for future use\n      localStorage.setItem('slackToken', token);\n\n      // Login with new token\n      login()\n    } else {\n      localStorage.removeItem('slackToken');\n      history.push(\"/login\");\n    }\n  }, [token])\n\n  // Logout\n  // Clear token and workspace information\n  const logout = () => {\n    setToken();\n    setWorkspace();\n  }\n\n  // Login\n  // Validate token and load workspace information\n  // If token is invalid, an alert will be shown\n  const login = async () => {\n    try {\n      await slackClient.validateToken();\n      setWorkspace(await slackClient.loadWorkspace());\n      if (location.pathname === '/login') {\n        history.push(\"/\")\n      }\n    } catch(err) {\n      // Token was invalid, reset and display alert\n      setToken()\n      alert(err)\n    }\n  }\n\n  const saveToken = event => {\n    event.preventDefault();\n    setToken(event.target[0].value);\n    event.target[0].value = '';\n  }\n\n  return (\n    <div className=\"App\">\n      <AppContext.Provider value={{slackClient, workspace}}>\n        <NavBar onLogout={logout}/>\n        <div className=\"content\">\n          <Route exact path=\"/\" component={Home} />\n          <Route path=\"/sendMessage\" component={SendMessage} />\n          <Route path=\"/scheduleMessage\" component={ScheduleMessage} />\n          <Route path=\"/login\" render={() => <TokenInput onSubmit={saveToken} />} />\n        </div>\n      </AppContext.Provider>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport { HashRouter } from 'react-router-dom';\n\nReactDOM.render(\n  <React.StrictMode>\n    <HashRouter>\n      <App />\n    </HashRouter>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}